<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"meetabs.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.13.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="My Notes">
<meta property="og:url" content="https://meetabs.github.io/page/10/index.html">
<meta property="og:site_name" content="My Notes">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="meetabs">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://meetabs.github.io/page/10/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/10/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>My Notes</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">My Notes</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="meetabs"
      src="/images/500px-linux-header-picture.png">
  <p class="site-author-name" itemprop="name">meetabs</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://meetabs.github.io/2022/11/13/tencent-dd-linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/500px-linux-header-picture.png">
      <meta itemprop="name" content="meetabs">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My Notes">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | My Notes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/11/13/tencent-dd-linux/" class="post-title-link" itemprop="url">腾讯云DD 纯净Linux系统</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-11-13 00:00:00" itemprop="dateCreated datePublished" datetime="2022-11-13T00:00:00+00:00">2022-11-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="删除腾讯组件"><a href="#删除腾讯组件" class="headerlink" title="删除腾讯组件"></a>删除腾讯组件</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">systemctl stop tat_agent</span><br><span class="line">systemctl disable tat_agent</span><br><span class="line">rm -rf <span class="regexp">/etc/</span>systemd<span class="regexp">/system/</span>tat_agent.service</span><br><span class="line">rm -fr <span class="regexp">/usr/</span>local/qcloud </span><br><span class="line"></span><br><span class="line">ps -A | grep agent</span><br><span class="line"><span class="comment"># 检查看是否还有腾讯云组件</span></span><br><span class="line"><span class="comment"># kill 这个进程 </span></span><br></pre></td></tr></table></figure>

<h4 id="更改hostname-可选"><a href="#更改hostname-可选" class="headerlink" title="更改hostname(可选)"></a>更改hostname(可选)</h4><p>一键DD脚本会读取当前的hostname, 如果你需要一个新的hostname可以更改当前hostname后再开始DD系统。这里更改hostname为”tencent”。</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hostname tencent</span></span><br></pre></td></tr></table></figure>

<h4 id="DD纯净系统"><a href="#DD纯净系统" class="headerlink" title="DD纯净系统"></a>DD纯净系统</h4><p>使用网上大佬的脚本</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget -N --no-check-certificate https:<span class="regexp">//</span>down.vpsaff.net<span class="regexp">/linux/</span>dd/network-reinstall-os.sh &amp;&amp; \</span><br><span class="line">chmod +x network-reinstall-os.sh &amp;&amp; ./network-reinstall-os.sh</span><br></pre></td></tr></table></figure>

<p>可以在vnc里面看到安装进度。</p>
<img src="/images/tencent-dd-linux/tencent-dd-linux-01-20221113.png" style="margin:0px">


<h4 id="脚本内容"><a href="#脚本内容" class="headerlink" title="脚本内容"></a>脚本内容</h4><details>
  <summary>network-reinstall-os.sh</summary>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">MAINIP=$(ip route get 1 | awk <span class="string">&#x27;&#123;print $7;exit&#125;&#x27;</span>)</span><br><span class="line">GATEWAYIP=$(ip route | grep default | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line">SUBNET=$(ip -o -f inet addr show | awk <span class="string">&#x27;/scope global/&#123;sub(/[^.]+\//,&quot;0/&quot;,$4);print $4&#125;&#x27;</span> | <span class="built_in">head</span> -1 | awk -F <span class="string">&#x27;/&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">value=$(( <span class="number">0</span>xffffffff ^ ((<span class="number">1</span> &lt;&lt; (<span class="number">32</span> - <span class="variable">$SUBNET</span>)) - 1) ))</span><br><span class="line">NETMASK=<span class="string">&quot;<span class="subst">$(( (value &gt;&gt; 24)</span> &amp; 0xff )).<span class="subst">$(( (value &gt;&gt; 16)</span> &amp; 0xff )).<span class="subst">$(( (value &gt;&gt; 8)</span> &amp; 0xff )).<span class="subst">$(( value &amp; 0xff )</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">wget --no-check-certificate -qO network-reinstall.sh <span class="string">&#x27;https://down.vpsaff.net/linux/dd/network-reinstall.sh&#x27;</span> &amp;&amp; <span class="built_in">chmod</span> a+x network-reinstall.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#Disabled SELinux</span></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/selinux/config ]; <span class="keyword">then</span></span><br><span class="line">	SELinuxStatus=$(sestatus -v | grep <span class="string">&quot;SELinux status:&quot;</span> | grep enabled)</span><br><span class="line">	[[ <span class="string">&quot;<span class="variable">$SELinuxStatus</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]] &amp;&amp; setenforce 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">clear</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;                                                              &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##############################################################&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#                                                            #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#  Network reinstall OS                                      #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#                                                            #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#  Last Modified: 2022-08-24                                 #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#  Linux默认密码：IdcOffer.com                               #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#  Supported by idcoffer.com                                 #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#                                                            #&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##############################################################&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;                                                              &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;IP: <span class="variable">$MAINIP</span>/<span class="variable">$SUBNET</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;网关: <span class="variable">$GATEWAYIP</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;网络掩码: <span class="variable">$NETMASK</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;请选择您需要的镜像包:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  0) 升级本脚本&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  1) Debian 10（Buster） 用户名：root 密码：IdcOffer.com&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  2) Debian 11（Bullseye）用户名：root 密码：IdcOffer.com ,推荐1G内存以上使用&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  3) CentOS 7 x64 (DD) 用户名：root 密码：Pwd@CentOS&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  4) CentOS 7 用户名：root 密码：IdcOffer.com, 要求2G RAM以上才能使用&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  5) Ubuntu 16.04 LTS (Xenial Xerus) 用户名：root 密码：IdcOffer.com&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  6) Ubuntu 18.04 LTS (Bionic Beaver) 用户名：root 密码：IdcOffer.com&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  7) Ubuntu 20.04 LTS (Focal Fossa) 用户名：root 密码：IdcOffer.com ,推荐2G内存以上使用&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  8) Fedora 32 用户名：root 密码：IdcOffer.com, 要求2G RAM以上才能使用&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  9) Fedora 33 用户名：root 密码：IdcOffer.com, 要求2G RAM以上才能使用&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  10) Fedora 34 用户名：root 密码：IdcOffer.com, 要求2G RAM以上才能使用&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  11) Fedora 35 用户名：root 密码：IdcOffer.com, 要求2G RAM以上才能使用&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  12) Fedora 36 用户名：root 密码：IdcOffer.com, 要求2G RAM以上才能使用&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  13) RockyLinux 8 (Green Obsidian) 用户名：root 密码：IdcOffer.com, 要求2G RAM以上才能使用&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  14) RockyLinux 9 (Blue Onyx) 用户名：root 密码：IdcOffer.com, 要求2G RAM以上才能使用&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  15) AlmaLinux 8 （Sky Tiger）用户名：root 密码：IdcOffer.com, 要求2G RAM以上才能使用&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  16) AlmaLinux 9 （Emerald Puma）用户名：root 密码：IdcOffer.com, 要求2G RAM以上才能使用&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  自定义安装请使用：bash network-reinstall.sh -dd &#x27;您的直连&#x27;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;请输入编号: &quot;</span></span><br><span class="line"><span class="built_in">read</span> N</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$N</span> <span class="keyword">in</span></span><br><span class="line">  0) wget --no-check-certificate -qO network-reinstall-os.sh <span class="string">&quot;https://down.vpsaff.net/linux/dd/network-reinstall-os.sh&quot;</span> &amp;&amp; <span class="built_in">chmod</span> +x network-reinstall-os.sh &amp;&amp; wget --no-check-certificate -qO network-reinstall.sh <span class="string">&#x27;https://down.vpsaff.net/linux/dd/network-reinstall.sh&#x27;</span> &amp;&amp; <span class="built_in">chmod</span> a+x network-reinstall.sh ;;</span><br><span class="line">  1) bash network-reinstall.sh -d 10 -p IdcOffer.com ;;</span><br><span class="line">  2) bash network-reinstall.sh -d 11 -p IdcOffer.com ;;</span><br><span class="line">  3) <span class="built_in">echo</span> <span class="string">&quot;Password: Pwd@CentOS&quot;</span> ; <span class="built_in">read</span> -s -n1 -p <span class="string">&quot;Press any key to continue...&quot;</span> ; bash network-reinstall.sh -<span class="built_in">dd</span> <span class="string">&#x27;https://down.vpsaff.net/linux/dd/images/centos-7-image&#x27;</span> ;;</span><br><span class="line">  4) bash network-reinstall.sh -c 7 -p IdcOffer.com ;;</span><br><span class="line">  5) bash network-reinstall.sh -u 16.04 -p IdcOffer.com ;;</span><br><span class="line">  6) bash network-reinstall.sh -u 18.04 -p IdcOffer.com ;;</span><br><span class="line">  7) bash network-reinstall.sh -u 20.04 -p IdcOffer.com ;;</span><br><span class="line">  8) bash network-reinstall.sh -f 32 -p IdcOffer.com ;;</span><br><span class="line">  9)  bash network-reinstall.sh -f 33 -p IdcOffer.com ;;</span><br><span class="line">  10) bash network-reinstall.sh -f 34 -p IdcOffer.com ;;</span><br><span class="line">  11) bash network-reinstall.sh -f 35 -p IdcOffer.com ;;</span><br><span class="line">  12) bash network-reinstall.sh -f 36 -p IdcOffer.com ;;</span><br><span class="line">  13) bash network-reinstall.sh -r 8 -p IdcOffer.com ;;</span><br><span class="line">  14) bash network-reinstall.sh -r 9 -p IdcOffer.com ;;</span><br><span class="line">  15) bash network-reinstall.sh -a 8 -p IdcOffer.com ;;</span><br><span class="line">  16) bash network-reinstall.sh -a 9 -p IdcOffer.com ;;</span><br><span class="line">  *) <span class="built_in">echo</span> <span class="string">&quot;Wrong input!&quot;</span> ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
</details>


<details>
  <summary>network-reinstall.sh</summary>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line">PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin</span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"></span><br><span class="line"><span class="comment">## License: GPL</span></span><br><span class="line"><span class="comment">## Blog: https://www.idcoffer.com</span></span><br><span class="line"><span class="comment">## Default root password: IdcOffer.com</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> tmpVER=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">export</span> tmpDIST=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">export</span> tmpWORD=<span class="string">&#x27;IdcOffer.com&#x27;</span></span><br><span class="line"><span class="built_in">export</span> tmpMirror=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">export</span> Relese=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">export</span> isMirror=<span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="built_in">export</span> ddMode=<span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="built_in">export</span> tmpURL=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> [[ <span class="variable">$#</span> -ge 1 ]]; <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">    -v|--ver)</span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      tmpVER=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      ;;</span><br><span class="line">    -d|--debian)</span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      Relese=<span class="string">&#x27;Debian&#x27;</span></span><br><span class="line">      tmpDIST=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      ;;</span><br><span class="line">    -u|--ubuntu)</span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      Relese=<span class="string">&#x27;Ubuntu&#x27;</span></span><br><span class="line">      tmpDIST=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      ;;</span><br><span class="line">    -c|--centos)</span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      Relese=<span class="string">&#x27;CentOS&#x27;</span></span><br><span class="line">      tmpDIST=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      ;;</span><br><span class="line">    -f|--fedora)</span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      Relese=<span class="string">&#x27;Fedora&#x27;</span></span><br><span class="line">      tmpDIST=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      ;;</span><br><span class="line">    -r|--rocky|--rockylinux)</span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      Relese=<span class="string">&#x27;RockyLinux&#x27;</span></span><br><span class="line">      tmpDIST=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">	  ;;</span><br><span class="line">    -a|--alma|--almalinux)</span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      Relese=<span class="string">&#x27;AlmaLinux&#x27;</span></span><br><span class="line">      tmpDIST=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      ;;</span><br><span class="line">    -<span class="built_in">dd</span>|--image)</span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      ddMode=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">      tmpURL=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      ;;</span><br><span class="line">    -p|--password)</span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      tmpWORD=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      ;;</span><br><span class="line">    --mirror)</span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      isMirror=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">      tmpMirror=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">      <span class="built_in">shift</span></span><br><span class="line">      ;;</span><br><span class="line">    *)</span><br><span class="line">      <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> != <span class="string">&#x27;error&#x27;</span> ]]; <span class="keyword">then</span> <span class="built_in">echo</span> -ne <span class="string">&quot;\nInvaild option: &#x27;<span class="variable">$1</span>&#x27;\n\n&quot;</span>; <span class="keyword">fi</span></span><br><span class="line">      <span class="built_in">echo</span> -ne <span class="string">&quot; Usage:\n\tbash <span class="subst">$(basename $0)</span>\t-d/--debian [dists-name]\n\t\t\t\t-u/--ubuntu [dists-name]\n\t\t\t\t-c/--centos [dists-verison]\n\t\t\t\t-r/--rocky [dists-verison]\n\t\t\t\t-r/--alma [dists-verison]\n\t\t\t\t-f/--fedora [dists-verison]\n\t\t\t\t-dd/--image\n\t\t\t\t--mirror\n&quot;</span></span><br><span class="line">      <span class="built_in">exit</span> 1;</span><br><span class="line">      ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[[ <span class="string">&quot;<span class="variable">$EUID</span>&quot;</span> -ne <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Error:This script must be run as root!&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1;</span><br><span class="line"></span><br><span class="line">total_memory=$(awk <span class="string">&#x27;($1 == &quot;MemTotal:&quot;)&#123;print $2&#125;&#x27;</span> /proc/meminfo)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;CentOS&#x27;</span> || <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;Fedora&#x27;</span> || <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;RockyLinux&#x27;</span>  || <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&quot;AlmaLinux&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	<span class="comment">#minimum 2G memory.</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$total_memory</span> -lt 1800000 ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> -e <span class="string">&quot;\n\033[31mError: \033[0mnetwork reinstall minimum 2G memory.&quot;</span>;</span><br><span class="line">		<span class="built_in">exit</span> 1;</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Remove QCloud servies</span></span><br><span class="line">[[ -f /usr/local/qcloud/YunJing/uninst.sh ]] &amp;&amp; <span class="built_in">echo</span> -e <span class="string">&quot;\nUninstall qcloud yunjing&quot;</span> &amp;&amp; bash /usr/local/qcloud/YunJing/uninst.sh &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line">[[ -f /usr/local/qcloud/stargate/admin/uninstall.sh ]] &amp;&amp; <span class="built_in">echo</span> -e <span class="string">&quot;\nUninstall qcloud stargate&quot;</span> &amp;&amp; bash /usr/local/qcloud/stargate/admin/uninstall.sh &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line">[[ -f /usr/local/qcloud/monitor/barad/admin/uninstall.sh ]] &amp;&amp; <span class="built_in">echo</span> -e <span class="string">&quot;\nUninstall qcloud monitor&quot;</span> &amp;&amp; bash /usr/local/qcloud/monitor/barad/admin/uninstall.sh &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="comment">#Disabled SELinux</span></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/selinux/config ]; <span class="keyword">then</span></span><br><span class="line">	SELinuxStatus=$(sestatus -v | grep <span class="string">&quot;SELinux status:&quot;</span> | grep enabled)</span><br><span class="line">	[[ <span class="string">&quot;<span class="variable">$SELinuxStatus</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]] &amp;&amp; <span class="built_in">echo</span> -e <span class="string">&quot;\033[36mDisabled SELinux\033[0m&quot;</span> &amp;&amp; setenforce 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Current relese and platform</span></span><br><span class="line">CurrentRelese=<span class="string">&#x27;&#x27;</span></span><br><span class="line">Ubuntu=$(<span class="built_in">cat</span> /proc/version | grep Ubuntu)</span><br><span class="line">Debian=$(<span class="built_in">cat</span> /proc/version | grep Debian)</span><br><span class="line">CentOS=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">Fedora=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">RockyLinux=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">AlmaLinux=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">[[ -f /etc/redhat-release ]] &amp;&amp; CentOS=$(<span class="built_in">cat</span> /etc/redhat-release | grep CentOS)</span><br><span class="line">[[ -f /etc/redhat-release ]] &amp;&amp; Fedora=$(<span class="built_in">cat</span> /etc/redhat-release | grep Fedora)</span><br><span class="line">[[ -f /etc/redhat-release ]] &amp;&amp; RockyLinux=$(<span class="built_in">cat</span> /etc/redhat-release | grep Rocky)</span><br><span class="line">[[ -f /etc/redhat-release ]] &amp;&amp; AlmaLinux=$(<span class="built_in">cat</span> /etc/redhat-release | grep Alma)</span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$Ubuntu</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	CurrentRelese=<span class="string">&quot;Ubuntu&quot;</span>;</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$Debian</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	CurrentRelese=<span class="string">&quot;Debian&quot;</span>;</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$CentOS</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	CurrentRelese=<span class="string">&quot;CentOS&quot;</span>;</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$Fedora</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	CurrentRelese=<span class="string">&quot;Fedora&quot;</span>;</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$RockyLinux</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	CurrentRelese=<span class="string">&quot;RockyLinux&quot;</span>;</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$AlmaLinux</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	CurrentRelese=<span class="string">&quot;AlmaLinux&quot;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> -e <span class="string">&quot;Only supported \033[36mCentOS\033[0m, \033[36mFedora\033[0m, \033[36mRockyLinux\033[0m, \033[36mAlmaLinux\033[0m, \033[36mUbuntu\033[0m and \033[36mDebian\033[0m.&quot;</span>;</span><br><span class="line">	<span class="built_in">exit</span> 1;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">PLATFORM=$(<span class="built_in">uname</span> -i);</span><br><span class="line">[[ <span class="string">&quot;<span class="variable">$PLATFORM</span>&quot;</span> == <span class="string">&quot;unknown&quot;</span> ]] &amp;&amp; PLATFORM=$(<span class="built_in">uname</span> -m)</span><br><span class="line"></span><br><span class="line">clear</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\033[36m# Is global\033[0m\n&quot;</span></span><br><span class="line">IsGlobal=<span class="string">&quot;0&quot;</span></span><br><span class="line">delay=<span class="string">&quot;<span class="subst">$(ping -4 -c 2 -w 2 www.google.com | grep rtt | cut -d&#x27;/&#x27; -f4 | awk &#x27;&#123; print $3 &#125;&#x27; | sed -n &#x27;/^[0-9]\+\(\.[0-9]\+\)\?$/p&#x27;)</span>&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$delay</span>&quot;</span> != <span class="string">&quot;&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">	IsGlobal=<span class="string">&quot;1&quot;</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;Yes&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;No&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">SelectMirror</span></span>()&#123;</span><br><span class="line">	[ <span class="variable">$#</span> -ge 3 ] || <span class="built_in">exit</span> 1</span><br><span class="line">	Relese=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">	DIST=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span> |sed <span class="string">&#x27;s/\ //g&#x27;</span> |sed -r <span class="string">&#x27;s/(.*)/\L\1/&#x27;</span>)</span><br><span class="line">	PLATFORM=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$3</span>&quot;</span> |sed <span class="string">&#x27;s/\ //g&#x27;</span> |sed -r <span class="string">&#x27;s/(.*)/\L\1/&#x27;</span>)</span><br><span class="line">	New=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$4</span>&quot;</span> |sed <span class="string">&#x27;s/\ //g&#x27;</span>)</span><br><span class="line">	[ -n <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> ] || <span class="built_in">exit</span> 1</span><br><span class="line">	[ -n <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> ] || <span class="built_in">exit</span> 1</span><br><span class="line">	[ -n <span class="string">&quot;<span class="variable">$PLATFORM</span>&quot;</span> ] || <span class="built_in">exit</span> 1</span><br><span class="line">	relese=$(<span class="built_in">echo</span> <span class="variable">$Relese</span> |sed -r <span class="string">&#x27;s/(.*)/\L\1/&#x27;</span>)</span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&quot;Debian&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&quot;Ubuntu&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">		inUpdate=<span class="string">&#x27;&#x27;</span>; [ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&quot;Ubuntu&quot;</span> ] &amp;&amp; inUpdate=<span class="string">&#x27;-updates&#x27;</span>	</span><br><span class="line">		imagesPart=<span class="string">&#x27;images&#x27;</span>; </span><br><span class="line">		<span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> == <span class="string">&quot;focal&quot;</span> ] || [ <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> == <span class="string">&quot;hirsute&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">			imagesPart=<span class="string">&#x27;legacy-images&#x27;</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">		MirrorTEMP=<span class="string">&quot;SUB_MIRROR/dists/<span class="variable">$&#123;DIST&#125;</span><span class="variable">$&#123;inUpdate&#125;</span>/main/installer-<span class="variable">$&#123;PLATFORM&#125;</span>/current/<span class="variable">$&#123;imagesPart&#125;</span>/netboot/<span class="variable">$&#123;relese&#125;</span>-installer/<span class="variable">$&#123;PLATFORM&#125;</span>/initrd.gz&quot;</span></span><br><span class="line">	<span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&quot;CentOS&quot;</span> || <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&quot;RockyLinux&quot;</span>  || <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&quot;AlmaLinux&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> =~ ^8.* ]] || [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&quot;RockyLinux&quot;</span>  || <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&quot;AlmaLinux&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">			MirrorTEMP=<span class="string">&quot;SUB_MIRROR/<span class="variable">$&#123;DIST&#125;</span>/BaseOS/<span class="variable">$&#123;PLATFORM&#125;</span>/os/isolinux/initrd.img&quot;</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			MirrorTEMP=<span class="string">&quot;SUB_MIRROR/<span class="variable">$&#123;DIST&#125;</span>/os/<span class="variable">$&#123;PLATFORM&#125;</span>/isolinux/initrd.img&quot;</span></span><br><span class="line">		<span class="keyword">fi</span>    </span><br><span class="line">	<span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&quot;Fedora&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">		MirrorTEMP=<span class="string">&quot;SUB_MIRROR/releases/<span class="variable">$&#123;DIST&#125;</span>/Server/<span class="variable">$&#123;PLATFORM&#125;</span>/os/isolinux/initrd.img&quot;</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	[ -n <span class="string">&quot;<span class="variable">$MirrorTEMP</span>&quot;</span> ] || <span class="built_in">exit</span> 1</span><br><span class="line">	MirrorStatus=0</span><br><span class="line">	<span class="built_in">declare</span> -A MirrorBackup</span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$IsGlobal</span>&quot;</span> == <span class="string">&quot;1&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">		MirrorBackup=([<span class="string">&quot;Debian0&quot;</span>]=<span class="string">&quot;&quot;</span> [<span class="string">&quot;Debian1&quot;</span>]=<span class="string">&quot;http://deb.debian.org/debian&quot;</span> [<span class="string">&quot;Debian2&quot;</span>]=<span class="string">&quot;http://archive.debian.org/debian&quot;</span> [<span class="string">&quot;Ubuntu0&quot;</span>]=<span class="string">&quot;&quot;</span> [<span class="string">&quot;Ubuntu1&quot;</span>]=<span class="string">&quot;http://archive.ubuntu.com/ubuntu&quot;</span> [<span class="string">&quot;Ubuntu2&quot;</span>]=<span class="string">&quot;http://ports.ubuntu.com&quot;</span> [<span class="string">&quot;CentOS0&quot;</span>]=<span class="string">&quot;&quot;</span> [<span class="string">&quot;CentOS1&quot;</span>]=<span class="string">&quot;http://mirror.centos.org/centos&quot;</span> [<span class="string">&quot;CentOS2&quot;</span>]=<span class="string">&quot;http://vault.centos.org&quot;</span> [<span class="string">&quot;Fedora0&quot;</span>]=<span class="string">&quot;&quot;</span> [<span class="string">&quot;Fedora1&quot;</span>]=<span class="string">&quot;https://mirrors.aliyun.com/fedora&quot;</span> [<span class="string">&quot;RockyLinux0&quot;</span>]=<span class="string">&quot;&quot;</span> [<span class="string">&quot;RockyLinux1&quot;</span>]=<span class="string">&quot;https://download.rockylinux.org/pub/rocky&quot;</span> [<span class="string">&quot;AlmaLinux0&quot;</span>]=<span class="string">&quot;&quot;</span> [<span class="string">&quot;AlmaLinux1&quot;</span>]=<span class="string">&quot;https://repo.almalinux.org/almalinux&quot;</span>)</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		MirrorBackup=([<span class="string">&quot;Debian0&quot;</span>]=<span class="string">&quot;&quot;</span> [<span class="string">&quot;Debian1&quot;</span>]=<span class="string">&quot;https://mirrors.aliyun.com/debian&quot;</span> [<span class="string">&quot;Debian2&quot;</span>]=<span class="string">&quot;http://mirrors.163.com/debian-archive&quot;</span> [<span class="string">&quot;Ubuntu0&quot;</span>]=<span class="string">&quot;&quot;</span> [<span class="string">&quot;Ubuntu1&quot;</span>]=<span class="string">&quot;http://mirrors.aliyun.com/ubuntu&quot;</span> [<span class="string">&quot;CentOS0&quot;</span>]=<span class="string">&quot;&quot;</span> [<span class="string">&quot;CentOS1&quot;</span>]=<span class="string">&quot;http://mirrors.aliyun.com/centos&quot;</span> [<span class="string">&quot;CentOS2&quot;</span>]=<span class="string">&quot;http://mirrors.aliyun.com/centos-vault&quot;</span> [<span class="string">&quot;Fedora0&quot;</span>]=<span class="string">&quot;&quot;</span> [<span class="string">&quot;Fedora1&quot;</span>]=<span class="string">&quot;https://mirrors.aliyun.com/fedora&quot;</span> [<span class="string">&quot;RockyLinux0&quot;</span>]=<span class="string">&quot;&quot;</span> [<span class="string">&quot;RockyLinux1&quot;</span>]=<span class="string">&quot;https://mirrors.aliyun.com/rockylinux&quot;</span> [<span class="string">&quot;AlmaLinux0&quot;</span>]=<span class="string">&quot;&quot;</span> [<span class="string">&quot;AlmaLinux1&quot;</span>]=<span class="string">&quot;https://mirrors.aliyun.com/almalinux&quot;</span>)</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$New</span>&quot;</span> |grep -q <span class="string">&#x27;^http://\|^https://\|^ftp://&#x27;</span> &amp;&amp; MirrorBackup[<span class="variable">$&#123;Relese&#125;</span>0]=<span class="string">&quot;<span class="variable">$New</span>&quot;</span></span><br><span class="line">	<span class="keyword">for</span> mirror <span class="keyword">in</span> $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;!MirrorBackup[@]&#125;</span>&quot;</span> |sed <span class="string">&#x27;s/\ /\n/g&#x27;</span> |<span class="built_in">sort</span> -n |grep <span class="string">&quot;^<span class="variable">$Relese</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">		CurMirror=<span class="string">&quot;<span class="variable">$&#123;MirrorBackup[$mirror]&#125;</span>&quot;</span></span><br><span class="line">		[ -n <span class="string">&quot;<span class="variable">$CurMirror</span>&quot;</span> ] || <span class="built_in">continue</span></span><br><span class="line">		MirrorURL=`<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$MirrorTEMP</span>&quot;</span> |sed <span class="string">&quot;s#SUB_MIRROR#<span class="variable">$&#123;CurMirror&#125;</span>#g&quot;</span>`</span><br><span class="line">		wget --no-check-certificate --spider --<span class="built_in">timeout</span>=3 -o /dev/null <span class="string">&quot;<span class="variable">$MirrorURL</span>&quot;</span></span><br><span class="line">		[ $? -eq 0 ] &amp;&amp; MirrorStatus=1 &amp;&amp; <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">  [ <span class="variable">$MirrorStatus</span> -eq 1 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$CurMirror</span>&quot;</span> || <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">CheckDependence</span></span>()&#123;</span><br><span class="line">FullDependence=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> BIN_DEP <span class="keyword">in</span> `<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> |sed <span class="string">&#x27;s/,/\n/g&#x27;</span>`</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [[ -n <span class="string">&quot;<span class="variable">$BIN_DEP</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">      Founded=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">      <span class="keyword">for</span> BIN_PATH <span class="keyword">in</span> `<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$PATH</span>&quot;</span> |sed <span class="string">&#x27;s/:/\n/g&#x27;</span>`</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">          <span class="built_in">ls</span> <span class="variable">$BIN_PATH</span>/<span class="variable">$BIN_DEP</span> &gt;/dev/null 2&gt;&amp;1;</span><br><span class="line">          <span class="keyword">if</span> [ $? == <span class="string">&#x27;0&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">            Founded=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">          <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">      <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$Founded</span>&quot;</span> == <span class="string">&#x27;1&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -en <span class="string">&quot;[\033[32mok\033[0m]\t&quot;</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        FullDependence=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        <span class="built_in">echo</span> -en <span class="string">&quot;[\033[31mNot Install\033[0m]&quot;</span>;</span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">      <span class="built_in">echo</span> -en <span class="string">&quot;\t<span class="variable">$BIN_DEP</span>\n&quot;</span>;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$FullDependence</span>&quot;</span> == <span class="string">&#x27;1&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> -ne <span class="string">&quot;\n\033[31mError! \033[0mPlease use &#x27;\033[33mapt\033[0m&#x27; or &#x27;\033[33myum\033[0m&#x27; install it.\n\n\n&quot;</span></span><br><span class="line">	<span class="built_in">exit</span> 1;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$ddMode</span>&quot;</span> == <span class="string">&#x27;1&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> -e <span class="string">&quot;\n\033[36m# Check <span class="variable">$tmpURL</span>\033[0m&quot;</span>;</span><br><span class="line">	<span class="keyword">if</span> [[ -n <span class="string">&quot;<span class="variable">$tmpURL</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		DDURL=<span class="string">&quot;<span class="variable">$tmpURL</span>&quot;</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DDURL</span>&quot;</span> |grep -q <span class="string">&#x27;^http://\|^ftp://\|^https://&#x27;</span>;</span><br><span class="line">		[[ $? -ne <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;Please input vaild URL,Only support http://, ftp:// and https:// !&#x27;</span> &amp;&amp; <span class="built_in">exit</span> 1;</span><br><span class="line">		wget --no-check-certificate --spider --<span class="built_in">timeout</span>=3 -o /dev/null <span class="string">&quot;<span class="variable">$DDURL</span>&quot;</span></span><br><span class="line">		[[ $? -ne <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;Please input vaild image URL! &#x27;</span> &amp;&amp; <span class="built_in">exit</span> 1;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&#x27;Please input vaild image URL! &#x27;</span>;</span><br><span class="line">		<span class="built_in">exit</span> 1;</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">	Relese=<span class="string">&#x27;Debian&#x27;</span>;</span><br><span class="line">	tmpDIST=<span class="string">&#x27;buster&#x27;</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&quot;Ubuntu&quot;</span> ]] || [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&quot;Debian&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$PLATFORM</span>&quot;</span> == <span class="string">&quot;x86_64&quot;</span> ]] || [[ <span class="string">&quot;<span class="variable">$PLATFORM</span>&quot;</span> == <span class="string">&quot;x64&quot;</span> ]] || [[ <span class="string">&quot;<span class="variable">$PLATFORM</span>&quot;</span> == <span class="string">&quot;64&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		PLATFORM=<span class="string">&quot;amd64&quot;</span></span><br><span class="line">	<span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$PLATFORM</span>&quot;</span> == <span class="string">&#x27;32&#x27;</span> ]] || [[ <span class="string">&quot;<span class="variable">$PLATFORM</span>&quot;</span> == <span class="string">&#x27;i386&#x27;</span> ]] || [[ <span class="string">&quot;<span class="variable">$PLATFORM</span>&quot;</span> == <span class="string">&#x27;x86&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		PLATFORM=<span class="string">&quot;i386&quot;</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$tmpDIST</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">  [ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;Debian&#x27;</span> ] &amp;&amp; tmpDIST=<span class="string">&#x27;bullseye&#x27;</span> &amp;&amp; DIST=<span class="string">&#x27;bullseye&#x27;</span>;</span><br><span class="line">  [ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;Ubuntu&#x27;</span> ] &amp;&amp; tmpDIST=<span class="string">&#x27;focal&#x27;</span> &amp;&amp; DIST=<span class="string">&#x27;focal&#x27;</span>;</span><br><span class="line">  [ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;CentOS&#x27;</span> ] &amp;&amp; tmpDIST=<span class="string">&#x27;8&#x27;</span> &amp;&amp; DIST=<span class="string">&#x27;8&#x27;</span>;</span><br><span class="line">  [ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;Fedora&#x27;</span> ] &amp;&amp; tmpDIST=<span class="string">&#x27;34&#x27;</span> &amp;&amp; DIST=<span class="string">&#x27;34&#x27;</span>;</span><br><span class="line">  [ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;RockyLinux&#x27;</span> ] &amp;&amp; tmpDIST=<span class="string">&#x27;8&#x27;</span> &amp;&amp; DIST=<span class="string">&#x27;8&#x27;</span>;</span><br><span class="line">  [ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;AlmaLinux&#x27;</span> ] &amp;&amp; tmpDIST=<span class="string">&#x27;8&#x27;</span> &amp;&amp; DIST=<span class="string">&#x27;8&#x27;</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">[ -n <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> ] || Relese=<span class="string">&#x27;Debian&#x27;</span></span><br><span class="line">linux_relese=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> |sed <span class="string">&#x27;s/\ //g&#x27;</span> |sed -r <span class="string">&#x27;s/(.*)/\L\1/&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\033[36m# Check Dependence\033[0m\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;Debian&#x27;</span> ]] || [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;Ubuntu&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$ddMode</span>&quot;</span> == <span class="string">&#x27;1&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		CheckDependence iconv;</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	CheckDependence wget,awk,grep,sed,<span class="built_in">cut</span>,<span class="built_in">cat</span>,cpio,gzip,find,<span class="built_in">dirname</span>,<span class="built_in">basename</span>,openssl;</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;CentOS&#x27;</span> || <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;Fedora&#x27;</span> || <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;RockyLinux&#x27;</span> || <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;AlmaLinux&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	CheckDependence wget,awk,grep,sed,<span class="built_in">cut</span>,<span class="built_in">cat</span>,cpio,gzip,find,<span class="built_in">dirname</span>,<span class="built_in">basename</span>,file,xz,openssl;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;Debian&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    SpikCheckDIST=<span class="string">&#x27;0&#x27;</span></span><br><span class="line">    DIST=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$tmpDIST</span>&quot;</span> |sed -r &#x27;s/(.*)</span>/\L\1/&#x27;)&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> |grep -q <span class="string">&#x27;[0-9]&#x27;</span>;</span><br><span class="line">    [[ $? -eq <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; &#123;</span><br><span class="line">      isDigital=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> |grep -o &#x27;[\.0-9]\&#123;1,\&#125;&#x27; |sed -n &#x27;1h;1!H;$g;s/\n//g;$p&#x27; |cut -d&#x27;.&#x27; -f1)</span>&quot;</span>;</span><br><span class="line">      [[ -n <span class="variable">$isDigital</span> ]] &amp;&amp; &#123;</span><br><span class="line">        [[ <span class="string">&quot;<span class="variable">$isDigital</span>&quot;</span> == <span class="string">&#x27;9&#x27;</span> ]] &amp;&amp; DIST=<span class="string">&#x27;stretch&#x27;</span>;</span><br><span class="line">        [[ <span class="string">&quot;<span class="variable">$isDigital</span>&quot;</span> == <span class="string">&#x27;10&#x27;</span> ]] &amp;&amp; DIST=<span class="string">&#x27;buster&#x27;</span>;</span><br><span class="line">        [[ <span class="string">&quot;<span class="variable">$isDigital</span>&quot;</span> == <span class="string">&#x27;11&#x27;</span> ]] &amp;&amp; DIST=<span class="string">&#x27;bullseye&#x27;</span>;</span><br><span class="line">        [[ <span class="string">&quot;<span class="variable">$isDigital</span>&quot;</span> == <span class="string">&#x27;12&#x27;</span> ]] &amp;&amp; DIST=<span class="string">&#x27;bookworm&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    LinuxMirror=$(SelectMirror <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> <span class="string">&quot;<span class="variable">$PLATFORM</span>&quot;</span> <span class="string">&quot;<span class="variable">$tmpMirror</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;Ubuntu&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    SpikCheckDIST=<span class="string">&#x27;0&#x27;</span></span><br><span class="line">    DIST=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$tmpDIST</span>&quot;</span> |sed -r &#x27;s/(.*)</span>/\L\1/&#x27;)&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> |grep -q <span class="string">&#x27;[0-9]&#x27;</span>;</span><br><span class="line">    [[ $? -eq <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; &#123;</span><br><span class="line">      isDigital=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> |grep -o &#x27;[\.0-9]\&#123;1,\&#125;&#x27; |sed -n &#x27;1h;1!H;$g;s/\n//g;$p&#x27;)</span>&quot;</span>;</span><br><span class="line">      [[ -n <span class="variable">$isDigital</span> ]] &amp;&amp; &#123;</span><br><span class="line">        [[ <span class="string">&quot;<span class="variable">$isDigital</span>&quot;</span> == <span class="string">&#x27;16.04&#x27;</span> ]] &amp;&amp; DIST=<span class="string">&#x27;xenial&#x27;</span>;</span><br><span class="line">        [[ <span class="string">&quot;<span class="variable">$isDigital</span>&quot;</span> == <span class="string">&#x27;18.04&#x27;</span> ]] &amp;&amp; DIST=<span class="string">&#x27;bionic&#x27;</span>;</span><br><span class="line">        [[ <span class="string">&quot;<span class="variable">$isDigital</span>&quot;</span> == <span class="string">&#x27;20.04&#x27;</span> ]] &amp;&amp; DIST=<span class="string">&#x27;focal&#x27;</span>;</span><br><span class="line">        [[ <span class="string">&quot;<span class="variable">$isDigital</span>&quot;</span> == <span class="string">&#x27;21.04&#x27;</span> ]] &amp;&amp; DIST=<span class="string">&#x27;hirsute&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    LinuxMirror=$(SelectMirror <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> <span class="string">&quot;<span class="variable">$PLATFORM</span>&quot;</span> <span class="string">&quot;<span class="variable">$tmpMirror</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;CentOS&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    SpikCheckDIST=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">    DISTCheck=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$tmpDIST</span>&quot;</span> |grep -o &#x27;[\.0-9]\&#123;1,\&#125;&#x27;)</span>&quot;</span>;</span><br><span class="line">    LinuxMirror=$(SelectMirror <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> <span class="string">&quot;<span class="variable">$DISTCheck</span>&quot;</span> <span class="string">&quot;<span class="variable">$PLATFORM</span>&quot;</span> <span class="string">&quot;<span class="variable">$tmpMirror</span>&quot;</span>)</span><br><span class="line">    ListDIST=<span class="string">&quot;<span class="subst">$(wget --no-check-certificate -qO- <span class="string">&quot;<span class="variable">$LinuxMirror</span>/dir_sizes&quot;</span> |cut -f2 |grep &#x27;^[0-9]&#x27;)</span>&quot;</span></span><br><span class="line">    DIST=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$ListDIST</span>&quot;</span> |grep <span class="string">&quot;^<span class="variable">$DISTCheck</span>&quot;</span> |head -n1)</span>&quot;</span></span><br><span class="line">    [[ -z <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> ]] &amp;&amp; &#123;</span><br><span class="line">      <span class="built_in">echo</span> -ne <span class="string">&#x27;\n\033[31mError! \033[0mThe dists version not found in this mirror, Please check it! \n\n&#x27;</span></span><br><span class="line">      bash <span class="variable">$0</span> error;</span><br><span class="line">      <span class="built_in">exit</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;Fedora&#x27;</span> || <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;RockyLinux&#x27;</span>  ||  <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;AlmaLinux&#x27;</span> ]] ; <span class="keyword">then</span></span><br><span class="line">    SpikCheckDIST=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">    DIST=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$tmpDIST</span>&quot;</span> |sed -r &#x27;s/(.*)</span>/\L\1/&#x27;)&quot;</span>;</span><br><span class="line">    LinuxMirror=$(SelectMirror <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> <span class="string">&quot;<span class="variable">$PLATFORM</span>&quot;</span> <span class="string">&quot;<span class="variable">$tmpMirror</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$SpikCheckDIST</span>&quot;</span> == <span class="string">&#x27;0&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> -e <span class="string">&quot;\n\033[36mCheck DIST\033[0m&quot;</span>;</span><br><span class="line">	DistsList=<span class="string">&quot;<span class="subst">$(wget --no-check-certificate -qO- <span class="string">&quot;<span class="variable">$LinuxMirror</span>/dists/&quot;</span> |grep -o &#x27;href=.*/<span class="string">&quot;&#x27; |cut -d&#x27;&quot;</span>&#x27; -f2 |sed &#x27;/-\|old\|Debian\|experimental\|stable\|test\|sid\|devel/d&#x27; |grep &#x27;^[^/]&#x27; |sed -n &#x27;1h;1!H;$g;s/\n//g;s/\//\;/g;$p&#x27;)</span>&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span> CheckDEB <span class="keyword">in</span> `<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DistsList</span>&quot;</span> |sed <span class="string">&#x27;s/;/\n/g&#x27;</span>`</span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">		[[ <span class="string">&quot;<span class="variable">$CheckDEB</span>&quot;</span> == <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> ]] &amp;&amp; FindDists=<span class="string">&#x27;1&#x27;</span> &amp;&amp; <span class="built_in">break</span>;</span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line">	[[ <span class="string">&quot;<span class="variable">$FindDists</span>&quot;</span> == <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; &#123;</span><br><span class="line">		<span class="built_in">echo</span> -ne <span class="string">&#x27;\n\033[31mError! \033[0mThe dists version not found, Please check it! \n\n&#x27;</span></span><br><span class="line">		bash <span class="variable">$0</span> error;</span><br><span class="line">		<span class="built_in">exit</span> 1;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">echo</span> -e <span class="string">&quot;\nSuccess&quot;</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">GRUBDIR=<span class="string">&quot;&quot;</span></span><br><span class="line">GRUBFILE=<span class="string">&quot;&quot;</span></span><br><span class="line">[[ -f <span class="string">&#x27;/boot/grub/grub.cfg&#x27;</span> ]] &amp;&amp; GRUBDIR=<span class="string">&#x27;/boot/grub&#x27;</span> &amp;&amp; GRUBFILE=<span class="string">&#x27;grub.cfg&#x27;</span>;</span><br><span class="line">[[ -z <span class="string">&quot;<span class="variable">$GRUBDIR</span>&quot;</span> ]] &amp;&amp; [[ -f <span class="string">&#x27;/boot/grub2/grub.cfg&#x27;</span> ]] &amp;&amp; GRUBDIR=<span class="string">&#x27;/boot/grub2&#x27;</span> &amp;&amp; GRUBFILE=<span class="string">&#x27;grub.cfg&#x27;</span>;</span><br><span class="line">[[ -z <span class="string">&quot;<span class="variable">$GRUBDIR</span>&quot;</span> ]] &amp;&amp; [[ -f <span class="string">&#x27;/boot/grub/grub.conf&#x27;</span> ]] &amp;&amp; GRUBDIR=<span class="string">&#x27;/boot/grub&#x27;</span> &amp;&amp; GRUBFILE=<span class="string">&#x27;grub.conf&#x27;</span>;</span><br><span class="line">[ -z <span class="string">&quot;<span class="variable">$GRUBDIR</span>&quot;</span> -o -z <span class="string">&quot;<span class="variable">$GRUBFILE</span>&quot;</span> ] &amp;&amp; <span class="built_in">echo</span> -ne <span class="string">&quot;Error! \nNot Found grub.\n&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1;</span><br><span class="line"></span><br><span class="line"><span class="comment">#Network config</span></span><br><span class="line">DEFAULTNET=$(ip route show |grep -o <span class="string">&#x27;default via [0-9]\&#123;1,3\&#125;.[0-9]\&#123;1,3\&#125;.[0-9]\&#123;1,3\&#125;.[0-9]\&#123;1,3\&#125;.*&#x27;</span> |<span class="built_in">head</span> -n1 |sed <span class="string">&#x27;s/proto.*\|onlink.*//g&#x27;</span> |awk <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>);</span><br><span class="line">PASSWORD=<span class="string">&quot;<span class="subst">$(openssl passwd -1 <span class="string">&quot;<span class="variable">$tmpWORD</span>&quot;</span>)</span>&quot;</span></span><br><span class="line">MAINIP=$(ip route get 1 | awk <span class="string">&#x27;&#123;print $7;exit&#125;&#x27;</span>)</span><br><span class="line">GATEWAYIP=$(ip route | grep default | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line">SUBNET=$(ip -o -f inet addr show | awk <span class="string">&#x27;/scope global/&#123;sub(/[^.]+\//,&quot;0/&quot;,$4);print $4&#125;&#x27;</span> | <span class="built_in">head</span> -1 | awk -F <span class="string">&#x27;/&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">value=$(( <span class="number">0</span>xffffffff ^ ((<span class="number">1</span> &lt;&lt; (<span class="number">32</span> - <span class="variable">$SUBNET</span>)) - 1) ))</span><br><span class="line">NETMASK=<span class="string">&quot;<span class="subst">$(( (value &gt;&gt; 24)</span> &amp; 0xff )).<span class="subst">$(( (value &gt;&gt; 16)</span> &amp; 0xff )).<span class="subst">$(( (value &gt;&gt; 8)</span> &amp; 0xff )).<span class="subst">$(( value &amp; 0xff )</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#DNS</span></span><br><span class="line">NAMESERVER=<span class="string">&quot;223.5.5.5 223.6.6.6&quot;</span> <span class="comment">#Aliyun DNS</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$CurrentRelese</span>&quot;</span> == <span class="string">&quot;CentOS&quot;</span> ]] || [[ <span class="string">&quot;<span class="variable">$CurrentRelese</span>&quot;</span> == <span class="string">&quot;Debian&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	NAMESERVER=$(awk <span class="string">&#x27;/^nameserver/&#123;print $2&#125;&#x27;</span> /etc/resolv.conf | <span class="built_in">tr</span> <span class="string">&quot;\n&quot;</span> <span class="string">&quot; &quot;</span> | awk <span class="string">&#x27;&#123;gsub(/^\s+|\s+$/, &quot;&quot;);print&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> [[ -f /run/systemd/resolve/resolv.conf ]]; <span class="keyword">then</span></span><br><span class="line">	NAMESERVER=$(<span class="built_in">cat</span> /run/systemd/resolve/resolv.conf | awk <span class="string">&#x27;/^nameserver/&#123;print $2&#125;&#x27;</span> | <span class="built_in">tr</span> <span class="string">&quot;\n&quot;</span> <span class="string">&quot; &quot;</span> | awk <span class="string">&#x27;&#123;gsub(/^\s+|\s+$/, &quot;&quot;);print&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> [[ -f /run/systemd/resolve/stub-resolv.conf ]]; <span class="keyword">then</span></span><br><span class="line">	NAMESERVER=$(<span class="built_in">cat</span> /run/systemd/resolve/stub-resolv.conf | awk <span class="string">&#x27;/^nameserver/&#123;print $2&#125;&#x27;</span> | <span class="built_in">tr</span> <span class="string">&quot;\n&quot;</span> <span class="string">&quot; &quot;</span> | awk <span class="string">&#x27;&#123;gsub(/^\s+|\s+$/, &quot;&quot;);print&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$IsGlobal</span>&quot;</span> == <span class="string">&quot;1&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">		NAMESERVER=<span class="string">&quot;1.1.1.1 8.8.8.8&quot;</span> <span class="comment">#Cloudflare Google DNS</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		delay=$(ping -c 3 -w 2 mirrors.tencentyun.com | grep rtt | <span class="built_in">cut</span> -d<span class="string">&#x27;/&#x27;</span> -f4 | awk <span class="string">&#x27;&#123; print $3 &#125;&#x27;</span> | sed -n <span class="string">&#x27;/^[0-9]\+\(\.[0-9]\+\)\?$/p&#x27;</span>)</span><br><span class="line">		<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$delay</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]] &amp;&amp; [[ <span class="variable">$delay</span> &lt; 2.0 ]];<span class="keyword">then</span></span><br><span class="line">			NAMESERVER=<span class="string">&quot;119.29.29.29&quot;</span> <span class="comment">#Tencent cloud DNS</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#RockyLinux 安装不支持多DNS，因此只保留第一个</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;RockyLinux&#x27;</span> ]] || [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;AlmaLinux&#x27;</span> ]] || [[ <span class="string">&quot;<span class="variable">$Relese</span>&quot;</span> == <span class="string">&#x27;Fedora&#x27;</span> ]];<span class="keyword">then</span></span><br><span class="line">	NAMESERVER=$(<span class="built_in">echo</span> <span class="variable">$NAMESERVER</span> | awk <span class="string">&#x27;NR==1&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Disable IPv6</span></span><br><span class="line">NOIPV6=<span class="string">&quot;&quot;</span></span><br><span class="line">ping6 -c 1 ipv6.baidu.com &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">if</span> [[ $? != 0 ]];<span class="keyword">then</span>    </span><br><span class="line">	ping6 -c 1 ipv6.google.com &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line">	<span class="keyword">if</span> [[ $? != 0 ]];<span class="keyword">then</span></span><br><span class="line">		NOIPV6=<span class="string">&quot;ipv6.disable=1&quot;</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#proto</span></span><br><span class="line">PROTO=<span class="string">&#x27;dhcp&#x27;</span></span><br><span class="line">PROTOStr=$(ip route show | grep  -o <span class="string">&#x27;default via [0-9]\&#123;1,3\&#125;.[0-9]\&#123;1,3\&#125;.[0-9]\&#123;1,3\&#125;.[0-9]\&#123;1,3\&#125;.*&#x27;</span> | grep proto)</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$PROTOStr</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">	static=$(ip route show | grep  -o <span class="string">&#x27;default via [0-9]\&#123;1,3\&#125;.[0-9]\&#123;1,3\&#125;.[0-9]\&#123;1,3\&#125;.[0-9]\&#123;1,3\&#125;.*&#x27;</span> | grep <span class="string">&#x27;proto static&#x27;</span>)</span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$static</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">		PROTO=<span class="string">&quot;static&quot;</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [ -f /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$DEFAULTNET</span> ]; <span class="keyword">then</span></span><br><span class="line">	device=$(<span class="built_in">cat</span> /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$DEFAULTNET</span> | grep DEVICE | grep <span class="variable">$DEFAULTNET</span>)</span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$device</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">		static=$(<span class="built_in">cat</span> /etc/sysconfig/network-scripts/ifcfg-<span class="variable">$DEFAULTNET</span> | grep BOOTPROTO | grep static)</span><br><span class="line">		<span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$static</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">			PROTO=<span class="string">&quot;static&quot;</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [ -f /etc/netplan/01-netcfg.yaml ]; <span class="keyword">then</span></span><br><span class="line">	device=$(<span class="built_in">cat</span> /etc/netplan/01-netcfg.yaml | grep <span class="variable">$DEFAULTNET</span>)</span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$device</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">		static=$(<span class="built_in">cat</span> /etc/netplan/01-netcfg.yaml | grep <span class="string">&quot;dhcp4: no&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$static</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">			PROTO=<span class="string">&quot;static&quot;</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [ -f /etc/network/interfaces ]; <span class="keyword">then</span></span><br><span class="line">	static=$(<span class="built_in">cat</span> /etc/network/interfaces | grep <span class="string">&quot;iface <span class="variable">$DEFAULTNET</span> inet static&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$static</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">		PROTO=<span class="string">&quot;static&quot;</span></span><br><span class="line">	<span class="keyword">elif</span> [ <span class="string">&quot;`ls -A /etc/network/interfaces.d`&quot;</span> != <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">for</span> config <span class="keyword">in</span> $(<span class="built_in">ls</span> -A /etc/network/interfaces.d)</span><br><span class="line">		<span class="keyword">do</span></span><br><span class="line">			<span class="keyword">if</span> [ -f /etc/network/interfaces.d/<span class="variable">$config</span> ]; <span class="keyword">then</span></span><br><span class="line">				static=$(<span class="built_in">cat</span> /etc/network/interfaces.d/<span class="variable">$config</span> | grep <span class="string">&quot;iface <span class="variable">$DEFAULTNET</span> inet static&quot;</span>);</span><br><span class="line">				<span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$static</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">					PROTO=<span class="string">&quot;static&quot;</span></span><br><span class="line">					<span class="built_in">break</span>;</span><br><span class="line">				<span class="keyword">fi</span></span><br><span class="line">			<span class="keyword">fi</span></span><br><span class="line">		<span class="keyword">done</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span>  -e <span class="string">&quot;\n\033[36m# Network config\033[0m&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hostname: <span class="subst">$(hostname)</span>&quot;</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;proto: <span class="variable">$PROTO</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ip: <span class="variable">$MAINIP</span>/<span class="variable">$SUBNET</span>&quot;</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;gateway: <span class="variable">$GATEWAYIP</span>&quot;</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;netmask: <span class="variable">$NETMASK</span>&quot;</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;nameserver: <span class="variable">$NAMESERVER</span>&quot;</span>;</span><br><span class="line">[[ <span class="string">&quot;<span class="variable">$NOIPV6</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;IPv6 is not supported&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n[\033[33m<span class="variable">$Relese</span>\033[0m] [\033[33m<span class="variable">$DIST</span>\033[0m] [\033[33m<span class="variable">$PLATFORM</span>\033[0m] Downloading...&quot;</span></span><br><span class="line">[[ -d /boot/netboot ]] &amp;&amp; <span class="built_in">rm</span> -rf /boot/netboot</span><br><span class="line"><span class="built_in">mkdir</span> /boot/netboot &amp;&amp; <span class="built_in">cd</span> /boot/netboot</span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;debian&#x27;</span> ]] || [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;ubuntu&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	inUpdate=<span class="string">&#x27;&#x27;</span>; [ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;ubuntu&#x27;</span> ] &amp;&amp; inUpdate=<span class="string">&#x27;-updates&#x27;</span></span><br><span class="line">	imagesPart=<span class="string">&#x27;images&#x27;</span>; </span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> == <span class="string">&quot;focal&quot;</span> ]] || [[ <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> == <span class="string">&quot;hirsute&quot;</span> ]] ; <span class="keyword">then</span></span><br><span class="line">		imagesPart=<span class="string">&#x27;legacy-images&#x27;</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	wget --no-check-certificate -qO <span class="string">&#x27;initrd.img&#x27;</span> <span class="string">&quot;<span class="variable">$&#123;LinuxMirror&#125;</span>/dists/<span class="variable">$&#123;DIST&#125;</span><span class="variable">$&#123;inUpdate&#125;</span>/main/installer-<span class="variable">$&#123;PLATFORM&#125;</span>/current/<span class="variable">$&#123;imagesPart&#125;</span>/netboot/<span class="variable">$&#123;linux_relese&#125;</span>-installer/<span class="variable">$&#123;PLATFORM&#125;</span>/initrd.gz&quot;</span></span><br><span class="line">	[[ $? -ne <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$LinuxMirror</span> <span class="variable">$linux_relese</span> <span class="variable">$Relese</span> <span class="variable">$DIST</span> <span class="variable">$PLATFORM</span>&quot;</span> &amp;&amp; <span class="built_in">echo</span> -ne <span class="string">&quot;\033[31mError! \033[0mDownload &#x27;initrd.img&#x27; for \033[33m<span class="variable">$linux_relese</span>\033[0m failed! \n&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line">	wget --no-check-certificate -qO <span class="string">&#x27;vmlinuz&#x27;</span> <span class="string">&quot;<span class="variable">$&#123;LinuxMirror&#125;</span>/dists/<span class="variable">$&#123;DIST&#125;</span><span class="variable">$&#123;inUpdate&#125;</span>/main/installer-<span class="variable">$&#123;PLATFORM&#125;</span>/current/<span class="variable">$&#123;imagesPart&#125;</span>/netboot/<span class="variable">$&#123;linux_relese&#125;</span>-installer/<span class="variable">$&#123;PLATFORM&#125;</span>/linux&quot;</span></span><br><span class="line">	[[ $? -ne <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; <span class="built_in">echo</span> -ne <span class="string">&quot;\033[31mError! \033[0mDownload &#x27;vmlinuz&#x27; for \033[33m<span class="variable">$linux_relese</span>\033[0m failed! \n&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line">	MirrorHost=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$LinuxMirror</span>&quot;</span> |awk -F&#x27;://|/&#x27; &#x27;&#123;print $2&#125;&#x27;)</span>&quot;</span>;</span><br><span class="line">	MirrorFolder=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$LinuxMirror</span>&quot;</span> |awk -F&#x27;&#x27;$&#123;MirrorHost&#125;&#x27;&#x27; &#x27;&#123;print $2&#125;&#x27;)</span>&quot;</span>;</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;centos&#x27;</span> || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;rockylinux&#x27;</span> || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;almalinux&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> =~ ^8.* ]] || [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;rockylinux&#x27;</span> || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;almalinux&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		wget --no-check-certificate -qO <span class="string">&#x27;initrd.img&#x27;</span> <span class="string">&quot;<span class="variable">$&#123;LinuxMirror&#125;</span>/<span class="variable">$&#123;DIST&#125;</span>/BaseOS/<span class="variable">$&#123;PLATFORM&#125;</span>/os/isolinux/initrd.img&quot;</span></span><br><span class="line">		[[ $? -ne <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; <span class="built_in">echo</span> -ne <span class="string">&quot;\033[31mError! \033[0mDownload &#x27;initrd.img&#x27; for \033[33m<span class="variable">$linux_relese</span>\033[0m failed! \n&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line">		wget --no-check-certificate -qO <span class="string">&#x27;vmlinuz&#x27;</span> <span class="string">&quot;<span class="variable">$&#123;LinuxMirror&#125;</span>/<span class="variable">$&#123;DIST&#125;</span>/BaseOS/<span class="variable">$&#123;PLATFORM&#125;</span>/os/isolinux/vmlinuz&quot;</span></span><br><span class="line">		[[ $? -ne <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; <span class="built_in">echo</span> -ne <span class="string">&quot;\033[31mError! \033[0mDownload &#x27;vmlinuz&#x27; for \033[33m<span class="variable">$linux_relese</span>\033[0m failed! \n&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		wget --no-check-certificate -qO <span class="string">&#x27;initrd.img&#x27;</span> <span class="string">&quot;<span class="variable">$&#123;LinuxMirror&#125;</span>/<span class="variable">$&#123;DIST&#125;</span>/os/<span class="variable">$&#123;PLATFORM&#125;</span>/isolinux/initrd.img&quot;</span></span><br><span class="line">		[[ $? -ne <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; <span class="built_in">echo</span> -ne <span class="string">&quot;\033[31mError! \033[0mDownload &#x27;initrd.img&#x27; for \033[33m<span class="variable">$linux_relese</span>\033[0m failed! \n&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line">		wget --no-check-certificate -qO <span class="string">&#x27;vmlinuz&#x27;</span> <span class="string">&quot;<span class="variable">$&#123;LinuxMirror&#125;</span>/<span class="variable">$&#123;DIST&#125;</span>/os/<span class="variable">$&#123;PLATFORM&#125;</span>/isolinux/vmlinuz&quot;</span></span><br><span class="line">		[[ $? -ne <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; <span class="built_in">echo</span> -ne <span class="string">&quot;\033[31mError! \033[0mDownload &#x27;vmlinuz&#x27; for \033[33m<span class="variable">$linux_relese</span>\033[0m failed! \n&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;fedora&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	wget --no-check-certificate -qO <span class="string">&#x27;initrd.img&#x27;</span> <span class="string">&quot;<span class="variable">$&#123;LinuxMirror&#125;</span>/releases/<span class="variable">$&#123;DIST&#125;</span>/Server/<span class="variable">$&#123;PLATFORM&#125;</span>/os/isolinux/initrd.img&quot;</span></span><br><span class="line">	[[ $? -ne <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; <span class="built_in">echo</span> -ne <span class="string">&quot;\033[31mError! \033[0mDownload &#x27;initrd.img&#x27; for \033[33m<span class="variable">$linux_relese</span>\033[0m failed! \n&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line">	wget --no-check-certificate -qO <span class="string">&#x27;vmlinuz&#x27;</span> <span class="string">&quot;<span class="variable">$&#123;LinuxMirror&#125;</span>/releases/<span class="variable">$&#123;DIST&#125;</span>/Server/<span class="variable">$&#123;PLATFORM&#125;</span>/os/isolinux/vmlinuz&quot;</span></span><br><span class="line">	[[ $? -ne <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; <span class="built_in">echo</span> -ne <span class="string">&quot;\033[31mError! \033[0mDownload &#x27;vmlinuz&#x27; for \033[33m<span class="variable">$linux_relese</span>\033[0m failed! \n&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  bash <span class="variable">$0</span> error;</span><br><span class="line">  <span class="built_in">exit</span> 1;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">[[ -d /tmp/boot ]] &amp;&amp; <span class="built_in">rm</span> -rf /tmp/boot;</span><br><span class="line"><span class="built_in">mkdir</span> -p /tmp/boot;</span><br><span class="line"><span class="built_in">mv</span> -f /boot/netboot/initrd.img /tmp/initrd.img;</span><br><span class="line"><span class="built_in">cd</span> /tmp/boot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;debian&#x27;</span> || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;ubuntu&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">  COMPTYPE=<span class="string">&quot;gzip&quot;</span>;</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;centos&#x27;</span> || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;fedora&#x27;</span> || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;rockylinux&#x27;</span> || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;almalinux&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">  COMPTYPE=<span class="string">&quot;<span class="subst">$(file ../initrd.img |grep -o &#x27;:.*compressed data&#x27; |cut -d&#x27; &#x27; -f2 |sed -r &#x27;s/(.*)</span>/\L\1/&#x27; |head -n1)&quot;</span></span><br><span class="line">  [[ -z <span class="string">&quot;<span class="variable">$COMPTYPE</span>&quot;</span> ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Detect compressed type fail.&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">CompDected=<span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="keyword">for</span> COMP <span class="keyword">in</span> `<span class="built_in">echo</span> -en <span class="string">&#x27;gzip\nlzma\nxz&#x27;</span>`</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$COMPTYPE</span>&quot;</span> == <span class="string">&quot;<span class="variable">$COMP</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">      CompDected=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">      <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$COMPTYPE</span>&quot;</span> == <span class="string">&#x27;gzip&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        NewIMG=<span class="string">&quot;initrd.img.gz&quot;</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        NewIMG=<span class="string">&quot;initrd.img.<span class="variable">$COMPTYPE</span>&quot;</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">      <span class="built_in">mv</span> -f <span class="string">&quot;/tmp/initrd.img&quot;</span> <span class="string">&quot;/tmp/<span class="variable">$NewIMG</span>&quot;</span></span><br><span class="line">      <span class="built_in">break</span>;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">[[ <span class="string">&quot;<span class="variable">$CompDected</span>&quot;</span> != <span class="string">&#x27;1&#x27;</span> ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Detect compressed type not support.&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1;</span><br><span class="line">[[ <span class="string">&quot;<span class="variable">$COMPTYPE</span>&quot;</span> == <span class="string">&#x27;lzma&#x27;</span> ]] &amp;&amp; UNCOMP=<span class="string">&#x27;xz --format=lzma --decompress&#x27;</span>;</span><br><span class="line">[[ <span class="string">&quot;<span class="variable">$COMPTYPE</span>&quot;</span> == <span class="string">&#x27;xz&#x27;</span> ]] &amp;&amp; UNCOMP=<span class="string">&#x27;xz --decompress&#x27;</span>;</span><br><span class="line">[[ <span class="string">&quot;<span class="variable">$COMPTYPE</span>&quot;</span> == <span class="string">&#x27;gzip&#x27;</span> ]] &amp;&amp; UNCOMP=<span class="string">&#x27;gzip -d&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$UNCOMP</span> &lt; /tmp/<span class="variable">$NewIMG</span> | cpio --extract --verbose --make-directories --no-absolute-filenames &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;centos&#x27;</span>  || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;fedora&#x27;</span> || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;rockylinux&#x27;</span> || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;almalinux&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	InstallURL=<span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;centos&#x27;</span> || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;rockylinux&#x27;</span> || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;almalinux&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> =~ ^8.* ]] || [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;rockylinux&#x27;</span> || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;almalinux&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">			InstallURL=<span class="string">&quot;<span class="variable">$&#123;LinuxMirror&#125;</span>/<span class="variable">$&#123;DIST&#125;</span>/BaseOS/<span class="variable">$&#123;PLATFORM&#125;</span>/os/&quot;</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			InstallURL=<span class="string">&quot;<span class="variable">$&#123;LinuxMirror&#125;</span>/<span class="variable">$&#123;DIST&#125;</span>/os/<span class="variable">$&#123;PLATFORM&#125;</span>/&quot;</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		InstallURL=<span class="string">&quot;<span class="variable">$&#123;LinuxMirror&#125;</span>/releases/<span class="variable">$&#123;DIST&#125;</span>/Server/<span class="variable">$&#123;PLATFORM&#125;</span>/os/&quot;</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	<span class="built_in">cat</span> &gt;/tmp/boot/ks.cfg&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">#platform x86, AMD64, or Intel EM64T</span></span><br><span class="line"><span class="string"># Firewall configuration</span></span><br><span class="line"><span class="string">firewall --enabled --ssh</span></span><br><span class="line"><span class="string">url --url=&quot;$InstallURL&quot;</span></span><br><span class="line"><span class="string"># Root password</span></span><br><span class="line"><span class="string">rootpw --iscrypted &quot;$PASSWORD&quot;</span></span><br><span class="line"><span class="string"># System authorization information</span></span><br><span class="line"><span class="string">authselect --useshadow --passalgo sha512</span></span><br><span class="line"><span class="string"># Disable system configuration</span></span><br><span class="line"><span class="string">firstboot --disable</span></span><br><span class="line"><span class="string">lang en_US</span></span><br><span class="line"><span class="string">keyboard us</span></span><br><span class="line"><span class="string"># SELinux configuration</span></span><br><span class="line"><span class="string">selinux --disabled</span></span><br><span class="line"><span class="string">logging --level=info</span></span><br><span class="line"><span class="string"># Reboot after installation</span></span><br><span class="line"><span class="string">reboot</span></span><br><span class="line"><span class="string">text</span></span><br><span class="line"><span class="string">#unsupported_hardware</span></span><br><span class="line"><span class="string">#vnc</span></span><br><span class="line"><span class="string">skipx</span></span><br><span class="line"><span class="string"># System timezone</span></span><br><span class="line"><span class="string">timezone --isUtc Asia/Shanghai</span></span><br><span class="line"><span class="string">network --bootproto=static --ip=$MAINIP --netmask=$NETMASK --gateway=$GATEWAYIP --nameserver=$NAMESERVER --hostname=$(hostname) --onboot=on</span></span><br><span class="line"><span class="string">bootloader --location=mbr --append=&quot;rhgb quiet crashkernel=auto&quot;</span></span><br><span class="line"><span class="string">zerombr</span></span><br><span class="line"><span class="string">clearpart --all --initlabel </span></span><br><span class="line"><span class="string">autopart</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">%packages --ignoremissing</span></span><br><span class="line"><span class="string">@base</span></span><br><span class="line"><span class="string">bind-utils</span></span><br><span class="line"><span class="string">net-tools</span></span><br><span class="line"><span class="string">wget</span></span><br><span class="line"><span class="string">vim</span></span><br><span class="line"><span class="string">openssl</span></span><br><span class="line"><span class="string">%end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">%post --interpreter=/bin/bash</span></span><br><span class="line"><span class="string">rm -rf /root/anaconda-ks.cfg</span></span><br><span class="line"><span class="string">rm -rf /root/install.*log</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sed -ri &quot;/^#?PermitRootLogin.*/c\PermitRootLogin yes&quot; /etc/ssh/sshd_config</span></span><br><span class="line"><span class="string">sed -ri &quot;/^#?PasswordAuthentication.*/c\PasswordAuthentication yes&quot; /etc/ssh/sshd_config</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">%end</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">	[[ <span class="string">&quot;<span class="variable">$PROTO</span>&quot;</span> -eq <span class="string">&#x27;dhcp&#x27;</span> ]] &amp;&amp; sed -i <span class="string">&quot;/^network.*/c\network --bootproto=dhcp --hostname=<span class="subst">$(hostname)</span> --onboot=on&quot;</span> /tmp/boot/ks.cfg;</span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;centos&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		[[ <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> =~ ^7.* ]] &amp;&amp; sed -i <span class="string">&quot;/^authselect.*/c\auth --useshadow --passalgo=sha512&quot;</span> /tmp/boot/ks.cfg;</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;rockylinux&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		sed -i <span class="string">&quot;/^@base.*/c\@\^minimal-environment&quot;</span> /tmp/boot/ks.cfg;</span><br><span class="line">		<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> =~ ^9.* ]]; <span class="keyword">then</span></span><br><span class="line">			sed -i <span class="string">&quot;/^timezone.*/c\timezone Asia\/Shanghai --utc&quot;</span> /tmp/boot/ks.cfg;</span><br><span class="line">			sed -i <span class="string">&quot;/^logging.*/c\logging&quot;</span> /tmp/boot/ks.cfg;</span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;almalinux&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> =~ ^9.* ]]; <span class="keyword">then</span></span><br><span class="line">			sed -i <span class="string">&quot;/^timezone.*/c\timezone Asia\/Shanghai --utc&quot;</span> /tmp/boot/ks.cfg;</span><br><span class="line">			sed -i <span class="string">&quot;/^logging.*/c\logging&quot;</span> /tmp/boot/ks.cfg;</span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">cat</span> &gt;/tmp/boot/preseed.cfg&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">#Low memory mode</span></span><br><span class="line"><span class="string">#d-i lowmem/low boolean true</span></span><br><span class="line"><span class="string"># Preseeding only locale sets language, country and locale.</span></span><br><span class="line"><span class="string">d-i debian-installer/country string US</span></span><br><span class="line"><span class="string">d-i debian-installer/language string en</span></span><br><span class="line"><span class="string">d-i debian-installer/locale string en_US.UTF-8</span></span><br><span class="line"><span class="string">d-i console-setup/layoutcode string us</span></span><br><span class="line"><span class="string"># Keyboard selection.</span></span><br><span class="line"><span class="string">d-i keyboard-configuration/xkb-keymap string us</span></span><br><span class="line"><span class="string">#Network console</span></span><br><span class="line"><span class="string">d-i netcfg/choose_interface select auto</span></span><br><span class="line"><span class="string">d-i netcfg/disable_autoconfig boolean true</span></span><br><span class="line"><span class="string">d-i netcfg/dhcp_failed note</span></span><br><span class="line"><span class="string">d-i netcfg/dhcp_options select Configure network manually</span></span><br><span class="line"><span class="string">d-i netcfg/get_ipaddress string $MAINIP</span></span><br><span class="line"><span class="string">d-i netcfg/get_netmask string $NETMASK</span></span><br><span class="line"><span class="string">d-i netcfg/get_gateway string $GATEWAYIP</span></span><br><span class="line"><span class="string">d-i netcfg/get_nameservers string $NAMESERVER</span></span><br><span class="line"><span class="string">d-i netcfg/no_default_route boolean true</span></span><br><span class="line"><span class="string">d-i netcfg/confirm_static boolean true</span></span><br><span class="line"><span class="string">d-i netcfg/hostname string $(hostname)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">d-i hw-detect/load_firmware boolean true</span></span><br><span class="line"><span class="string">#Mirror settings</span></span><br><span class="line"><span class="string">d-i mirror/country string manual</span></span><br><span class="line"><span class="string">d-i mirror/http/hostname string $MirrorHost</span></span><br><span class="line"><span class="string">d-i mirror/http/directory string $MirrorFolder</span></span><br><span class="line"><span class="string">d-i mirror/http/proxy string</span></span><br><span class="line"><span class="string">d-i apt-setup/services-select multiselect</span></span><br><span class="line"><span class="string">#Account setup</span></span><br><span class="line"><span class="string">d-i passwd/root-login boolean ture</span></span><br><span class="line"><span class="string">d-i passwd/make-user boolean false</span></span><br><span class="line"><span class="string">d-i passwd/root-password-crypted password $PASSWORD</span></span><br><span class="line"><span class="string">d-i user-setup/allow-password-weak boolean true</span></span><br><span class="line"><span class="string">d-i user-setup/encrypt-home boolean false</span></span><br><span class="line"><span class="string">#Clock and time zone setup</span></span><br><span class="line"><span class="string">d-i clock-setup/utc boolean true</span></span><br><span class="line"><span class="string">d-i time/zone string Asia/Shanghai</span></span><br><span class="line"><span class="string">d-i clock-setup/ntp-server string ntp.aliyun.com</span></span><br><span class="line"><span class="string">d-i clock-setup/ntp boolean true</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">d-i preseed/early_command string anna-install libfuse2-udeb fuse-udeb ntfs-3g-udeb libcrypto1.1-udeb libpcre2-8-0-udeb libssl1.1-udeb libuuid1-udeb zlib1g-udeb wget-udeb</span></span><br><span class="line"><span class="string">d-i partman/early_command string [[ -n &quot;\$(blkid -t TYPE=&#x27;vfat&#x27; -o device)&quot; ]] &amp;&amp; umount &quot;\$(blkid -t TYPE=&#x27;vfat&#x27; -o device)&quot;; \</span></span><br><span class="line"><span class="string">debconf-set partman-auto/disk &quot;\$(list-devices disk |head -n1)&quot;; \</span></span><br><span class="line"><span class="string">wget -qO- &#x27;$DDURL&#x27; |gunzip -dc |/bin/dd of=\$(list-devices disk |head -n1); \</span></span><br><span class="line"><span class="string">mount.ntfs-3g \$(list-devices partition |head -n1) /mnt; \</span></span><br><span class="line"><span class="string">cd &#x27;/mnt/ProgramData/Microsoft/Windows/Start Menu/Programs&#x27;; \</span></span><br><span class="line"><span class="string">cd Start* || cd start*; \</span></span><br><span class="line"><span class="string">cp -f &#x27;/net.bat&#x27; &#x27;./net.bat&#x27;; \</span></span><br><span class="line"><span class="string">/sbin/reboot; \</span></span><br><span class="line"><span class="string">umount /media || true; \</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">d-i partman/mount_style select uuid</span></span><br><span class="line"><span class="string">d-i partman-auto/init_automatically_partition select Guided - use entire disk</span></span><br><span class="line"><span class="string">d-i partman-auto/choose_recipe select All files in one partition (recommended for new users)</span></span><br><span class="line"><span class="string">d-i partman-auto/method string regular</span></span><br><span class="line"><span class="string">d-i partman-lvm/device_remove_lvm boolean true</span></span><br><span class="line"><span class="string">d-i partman-md/device_remove_md boolean true</span></span><br><span class="line"><span class="string">d-i partman-auto/choose_recipe select atomic</span></span><br><span class="line"><span class="string">d-i partman-partitioning/confirm_write_new_label boolean true</span></span><br><span class="line"><span class="string">d-i partman/choose_partition select finish</span></span><br><span class="line"><span class="string">d-i partman-lvm/confirm boolean true</span></span><br><span class="line"><span class="string">d-i partman-lvm/confirm_nooverwrite boolean true</span></span><br><span class="line"><span class="string">d-i partman/confirm boolean true</span></span><br><span class="line"><span class="string">d-i partman/confirm_nooverwrite boolean true</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">d-i debian-installer/allow_unauthenticated boolean true</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">tasksel tasksel/first multiselect minimal</span></span><br><span class="line"><span class="string">d-i pkgsel/update-policy select none</span></span><br><span class="line"><span class="string">d-i pkgsel/include string openssh-server net-tools</span></span><br><span class="line"><span class="string">d-i pkgsel/upgrade select none</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">popularity-contest popularity-contest/participate boolean false</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">d-i grub-installer/only_debian boolean true</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">d-i grub-installer/bootdev  string default</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Avoid that last message about the install being complete.</span></span><br><span class="line"><span class="string">d-i finish-install/reboot_in_progress note</span></span><br><span class="line"><span class="string">d-i debian-installer/exit/reboot boolean true</span></span><br><span class="line"><span class="string"># Verbose output and no boot splash screen.</span></span><br><span class="line"><span class="string">d-i debian-installer/quiet boolean false</span></span><br><span class="line"><span class="string">d-i debian-installer/splash boolean false</span></span><br><span class="line"><span class="string">d-i preseed/late_command string	\</span></span><br><span class="line"><span class="string">sed -ri &#x27;s/^#?PermitRootLogin.*/PermitRootLogin yes/g&#x27; /target/etc/ssh/sshd_config; \</span></span><br><span class="line"><span class="string">sed -ri &#x27;s/^#?PasswordAuthentication.*/PasswordAuthentication yes/g&#x27; /target/etc/ssh/sshd_config; \</span></span><br><span class="line"><span class="string">apt-install wget curl xz-utils file;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$PROTO</span>&quot;</span> == <span class="string">&#x27;dhcp&#x27;</span> ]]; <span class="keyword">then</span> </span><br><span class="line">		sed -i <span class="string">&#x27;/netcfg\/disable_autoconfig/d&#x27;</span> /tmp/boot/preseed.cfg</span><br><span class="line">		sed -i <span class="string">&#x27;/netcfg\/dhcp_failed/d&#x27;</span> /tmp/boot/preseed.cfg</span><br><span class="line">		sed -i <span class="string">&#x27;/netcfg\/dhcp_options/d&#x27;</span> /tmp/boot/preseed.cfg</span><br><span class="line">		sed -i <span class="string">&#x27;/netcfg\/get_.*/d&#x27;</span> /tmp/boot/preseed.cfg</span><br><span class="line">		sed -i <span class="string">&#x27;/netcfg\/confirm_static/d&#x27;</span> /tmp/boot/preseed.cfg</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	</span><br><span class="line">	[[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;debian&#x27;</span> ]] &amp;&amp; &#123;</span><br><span class="line">		sed -i <span class="string">&#x27;/user-setup\/allow-password-weak/d&#x27;</span> /tmp/boot/preseed.cfg</span><br><span class="line">		sed -i <span class="string">&#x27;/user-setup\/encrypt-home/d&#x27;</span> /tmp/boot/preseed.cfg</span><br><span class="line">		sed -i <span class="string">&#x27;/pkgsel\/update-policy/d&#x27;</span> /tmp/boot/preseed.cfg</span><br><span class="line">		sed -i <span class="string">&#x27;s/umount\ \/media.*true\;\ //g&#x27;</span> /tmp/boot/preseed.cfg</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> == <span class="string">&quot;bullseye&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">			<span class="keyword">if</span> [ <span class="variable">$total_memory</span> -lt 800000 ]; <span class="keyword">then</span></span><br><span class="line">				<span class="comment">#Low memory mode</span></span><br><span class="line">				sed -i <span class="string">&quot;/#d-i lowmem\/low.*/c\d-i lowmem\/low boolean true&quot;</span> /tmp/boot/preseed.cfg;</span><br><span class="line">			<span class="keyword">fi</span></span><br><span class="line">		<span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$DIST</span>&quot;</span> == <span class="string">&quot;buster&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">			<span class="keyword">if</span> [ <span class="variable">$total_memory</span> -lt 524288 ]; <span class="keyword">then</span></span><br><span class="line">				<span class="comment">#Low memory mode</span></span><br><span class="line">				sed -i <span class="string">&quot;/#d-i lowmem\/low.*/c\d-i lowmem\/low boolean true&quot;</span> /tmp/boot/preseed.cfg;</span><br><span class="line">			<span class="keyword">fi</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">	[[ <span class="string">&quot;<span class="variable">$ddMode</span>&quot;</span> == <span class="string">&#x27;0&#x27;</span> ]] &amp;&amp; &#123;</span><br><span class="line">		sed -i <span class="string">&#x27;/anna-install/d&#x27;</span> /tmp/boot/preseed.cfg</span><br><span class="line">		sed -i <span class="string">&#x27;s/wget.*\/sbin\/reboot\;\ //g&#x27;</span> /tmp/boot/preseed.cfg</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">find . | cpio -H newc --create --verbose | gzip -9 &gt; /tmp/initrd.img;</span><br><span class="line"><span class="built_in">mv</span> -f /tmp/initrd.img /boot/netboot/initrd.img;</span><br><span class="line"><span class="built_in">rm</span> -rf /tmp/boot;</span><br><span class="line"></span><br><span class="line"><span class="built_in">mv</span> -f /boot/netboot/vmlinuz /boot/vmlinuz</span><br><span class="line"><span class="built_in">mv</span> -f /boot/netboot/initrd.img /boot/initrd.img</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"></span><br><span class="line"><span class="comment">#Backup grub config file</span></span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$GRUBDIR</span>/<span class="variable">$GRUBFILE</span> <span class="string">&quot;<span class="variable">$GRUBDIR</span>/<span class="variable">$GRUBFILE</span>.bak_<span class="subst">$(date <span class="string">&quot;+%Y%m%d%k%M%S&quot;</span>)</span>&quot;</span></span><br><span class="line"></span><br><span class="line">READGRUB=<span class="string">&#x27;/tmp/grub.read&#x27;</span></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$GRUBDIR</span>/<span class="variable">$GRUBFILE</span> |sed -n <span class="string">&#x27;1h;1!H;$g;s/\n/%%%%%%%/g;$p&#x27;</span> |grep -om 1 <span class="string">&#x27;menuentry\ [^&#123;]*&#123;[^&#125;]*&#125;%%%%%%%&#x27;</span> |sed <span class="string">&#x27;s/%%%%%%%/\n/g&#x27;</span> &gt;<span class="variable">$READGRUB</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="subst">$(cat $READGRUB)</span>&quot;</span> != <span class="string">&quot;&quot;</span> &amp;&amp; <span class="string">&quot;<span class="subst">$(cat $READGRUB|grep &#x27;/vmlinuz&#x27;)</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	LoadNum=<span class="string">&quot;<span class="subst">$(cat $READGRUB |grep -c &#x27;menuentry &#x27;)</span>&quot;</span></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$LoadNum</span>&quot;</span> -eq <span class="string">&#x27;1&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">cat</span> <span class="variable">$READGRUB</span> |sed <span class="string">&#x27;/^$/d&#x27;</span> &gt;/tmp/grub.new;</span><br><span class="line">	<span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$LoadNum</span>&quot;</span> -gt <span class="string">&#x27;1&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	CFG0=<span class="string">&quot;<span class="subst">$(awk &#x27;/menuentry /&#123;print NR&#125;&#x27; $READGRUB|head -n 1)</span>&quot;</span>;</span><br><span class="line">	CFG2=<span class="string">&quot;<span class="subst">$(awk &#x27;/menuentry /&#123;print NR&#125;&#x27; $READGRUB|head -n 2 |tail -n 1)</span>&quot;</span>;</span><br><span class="line">	CFG1=<span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span> tmpCFG <span class="keyword">in</span> `awk <span class="string">&#x27;/&#125;/&#123;print NR&#125;&#x27;</span> <span class="variable">$READGRUB</span>`</span><br><span class="line">	  <span class="keyword">do</span></span><br><span class="line">		[ <span class="string">&quot;<span class="variable">$tmpCFG</span>&quot;</span> -gt <span class="string">&quot;<span class="variable">$CFG0</span>&quot;</span> -a <span class="string">&quot;<span class="variable">$tmpCFG</span>&quot;</span> -lt <span class="string">&quot;<span class="variable">$CFG2</span>&quot;</span> ] &amp;&amp; CFG1=<span class="string">&quot;<span class="variable">$tmpCFG</span>&quot;</span>;</span><br><span class="line">	  <span class="keyword">done</span></span><br><span class="line">	[[ -z <span class="string">&quot;<span class="variable">$CFG1</span>&quot;</span> ]] &amp;&amp; &#123;</span><br><span class="line">	  <span class="built_in">echo</span> <span class="string">&quot;Error! read <span class="variable">$GRUBFILE</span>. &quot;</span>;</span><br><span class="line">	  <span class="built_in">exit</span> 1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	sed -n <span class="string">&quot;<span class="variable">$CFG0</span>,<span class="variable">$CFG1</span>&quot;</span>p <span class="variable">$READGRUB</span> &gt;/tmp/grub.new;</span><br><span class="line">	[[ -f /tmp/grub.new ]] &amp;&amp; [[ <span class="string">&quot;<span class="subst">$(grep -c &#x27;&#123;&#x27; /tmp/grub.new)</span>&quot;</span> -eq <span class="string">&quot;<span class="subst">$(grep -c &#x27;&#125;&#x27; /tmp/grub.new)</span>&quot;</span> ]] || &#123;</span><br><span class="line">	  <span class="built_in">echo</span> -ne <span class="string">&quot;\033[31mError! \033[0mNot configure <span class="variable">$GRUBFILE</span>. \n&quot;</span>;</span><br><span class="line">	  <span class="built_in">exit</span> 1;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	[ ! -f /tmp/grub.new ] &amp;&amp; <span class="built_in">echo</span> -e <span class="string">&quot;\033[31mError! \033[0m <span class="variable">$GRUBFILE</span>. &quot;</span> &amp;&amp; <span class="built_in">exit</span> 1;</span><br><span class="line">	</span><br><span class="line">	sed -i <span class="string">&quot;/menuentry.*/c\menuentry\ \&#x27;Install <span class="variable">$Relese</span> <span class="variable">$DIST</span>\&#x27;\ --class <span class="variable">$linux_relese</span>\ --class\ gnu-linux\ --class\ gnu\ --class\ os\ \&#123;&quot;</span> /tmp/grub.new</span><br><span class="line">	sed -i <span class="string">&quot;/echo.*Loading/d&quot;</span> /tmp/grub.new;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	sed -i <span class="string">&quot;/menuentry.*/c\menuentry\ \&#x27;Install <span class="variable">$Relese</span> <span class="variable">$DIST</span>\&#x27;\ --class <span class="variable">$linux_relese</span>\ --class\ gnu-linux\ --class\ gnu\ --class\ os\ \&#123;&quot;</span> /tmp/grub.new;</span><br><span class="line">	</span><br><span class="line">	LinuxKernel=<span class="string">&quot;<span class="subst">$(grep &#x27;linux.*/\|kernel.*/&#x27; /tmp/grub.new |awk &#x27;&#123;print $1&#125;&#x27; |head -n 1)</span>&quot;</span>;</span><br><span class="line">	[[ -z <span class="string">&quot;<span class="variable">$LinuxKernel</span>&quot;</span> ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Error! read grub config! &quot;</span> &amp;&amp; <span class="built_in">exit</span> 1;</span><br><span class="line">	LinuxIMG=<span class="string">&quot;<span class="subst">$(grep &#x27;initrd.*/&#x27; /tmp/grub.new |awk &#x27;&#123;print $1&#125;&#x27; |tail -n 1)</span>&quot;</span>;</span><br><span class="line">	[ -z <span class="string">&quot;<span class="variable">$LinuxIMG</span>&quot;</span> ] &amp;&amp; sed -i <span class="string">&quot;/<span class="variable">$LinuxKernel</span>.*\//a\\\tinitrd\ \/&quot;</span> /tmp/grub.new &amp;&amp; LinuxIMG=<span class="string">&#x27;initrd&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;debian&#x27;</span> ]] || [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;ubuntu&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		BOOT_OPTION=<span class="string">&quot;auto=true <span class="variable">$NOIPV6</span> hostname=<span class="variable">$linux_relese</span> domain= -- quiet&quot;</span></span><br><span class="line">	<span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;centos&#x27;</span> ||  <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;fedora&#x27;</span>  || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;rockylinux&#x27;</span> || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;almalinux&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		BOOT_OPTION=<span class="string">&quot;inst.ks=file://ks.cfg <span class="variable">$NOIPV6</span> quiet&quot;</span>;</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">	[[ -n <span class="string">&quot;<span class="subst">$(grep &#x27;linux.*/\|kernel.*/&#x27; /tmp/grub.new |awk &#x27;&#123;print $2&#125;&#x27; |tail -n 1 |grep &#x27;^/boot/&#x27;)</span>&quot;</span> ]] &amp;&amp; Type=<span class="string">&#x27;InBoot&#x27;</span> || Type=<span class="string">&#x27;NoBoot&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	[[ <span class="string">&quot;<span class="variable">$Type</span>&quot;</span> == <span class="string">&#x27;InBoot&#x27;</span> ]] &amp;&amp; &#123;</span><br><span class="line">		sed -i <span class="string">&quot;/<span class="variable">$LinuxKernel</span>.*\//c\\\t<span class="variable">$LinuxKernel</span>\\t\/boot\/vmlinuz <span class="variable">$BOOT_OPTION</span>&quot;</span> /tmp/grub.new;</span><br><span class="line">		sed -i <span class="string">&quot;/<span class="variable">$LinuxIMG</span>.*\//c\\\t<span class="variable">$LinuxIMG</span>\\t\/boot\/initrd.img&quot;</span> /tmp/grub.new;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	[[ <span class="string">&quot;<span class="variable">$Type</span>&quot;</span> == <span class="string">&#x27;NoBoot&#x27;</span> ]] &amp;&amp; &#123;</span><br><span class="line">		sed -i <span class="string">&quot;/<span class="variable">$LinuxKernel</span>.*\//c\\\t<span class="variable">$LinuxKernel</span>\\t\/vmlinuz <span class="variable">$BOOT_OPTION</span>&quot;</span> /tmp/grub.new;</span><br><span class="line">		sed -i <span class="string">&quot;/<span class="variable">$LinuxIMG</span>.*\//c\\\t<span class="variable">$LinuxIMG</span>\\t\/initrd.img&quot;</span> /tmp/grub.new;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; /etc/grub.d/40_custom</span><br><span class="line">	<span class="built_in">cat</span> /tmp/grub.new &gt;&gt; /etc/grub.d/40_custom</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="keyword">if</span> [[ -f /boot/grub2/grubenv ]] &amp;&amp; [[ -d /boot/loader/entries ]] &amp;&amp; [[ <span class="string">&quot;<span class="subst">$(ls /boot/loader/entries|wc -w)</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		LoaderPath=$(<span class="built_in">cat</span> /boot/grub2/grubenv | grep <span class="string">&#x27;saved_entry=&#x27;</span> | awk -F <span class="string">&#x27;=&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">		[[ <span class="string">&quot;<span class="subst">$(cat /boot/loader/entries/$LoaderPath.conf | grep &#x27;^linux /boot/&#x27;)</span>&quot;</span> ]] &amp;&amp; BootDIR=<span class="string">&#x27;/boot&#x27;</span> || BootDIR=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		[[ -n <span class="string">&quot;<span class="subst">$(grep &#x27;linux.*/\|kernel.*/&#x27; $GRUBDIR/$GRUBFILE |awk &#x27;&#123;print $2&#125;&#x27; |tail -n 1 |grep &#x27;^/boot/&#x27;)</span>&quot;</span> ]] &amp;&amp; BootDIR=<span class="string">&#x27;/boot&#x27;</span> || BootDIR=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;ubuntu&#x27;</span>  || <span class="string">&quot;<span class="variable">$linux_relese</span>&quot;</span> == <span class="string">&#x27;debian&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">cat</span> &gt;&gt; /etc/grub.d/40_custom &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">menuentry &#x27;Install $Relese $DIST&#x27; --class $linux_relese --class gnu-linux --class gnu --class os &#123;</span></span><br><span class="line"><span class="string">  load_video</span></span><br><span class="line"><span class="string">  insmod gzio</span></span><br><span class="line"><span class="string">  insmod part_msdos</span></span><br><span class="line"><span class="string">  insmod ext2</span></span><br><span class="line"><span class="string">  insmod xfs</span></span><br><span class="line"><span class="string">  $(cat $GRUBDIR/$GRUBFILE | grep -m 1 -A 4 &quot;if \[ x\$feature_platform_search_hint&quot;)</span></span><br><span class="line"><span class="string">  linux16 $BootDIR/vmlinuz auto=true $NOIPV6 hostname=$(hostname) domain= -- quiet</span></span><br><span class="line"><span class="string">  initrd16 $BootDIR/initrd.img</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">cat</span> &gt;&gt; /etc/grub.d/40_custom &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">menuentry &#x27;Install $Relese $DIST&#x27; --class $linux_relese --class gnu-linux --class gnu --class os &#123;</span></span><br><span class="line"><span class="string">  load_video</span></span><br><span class="line"><span class="string">  insmod gzio</span></span><br><span class="line"><span class="string">  insmod part_msdos</span></span><br><span class="line"><span class="string">  insmod ext2</span></span><br><span class="line"><span class="string">  insmod xfs</span></span><br><span class="line"><span class="string">  set root=&#x27;hd0,msdos1&#x27;</span></span><br><span class="line"><span class="string">  $(cat $GRUBDIR/$GRUBFILE | grep -m 1 -A 4 &quot;if \[ x\$feature_platform_search_hint&quot;)</span></span><br><span class="line"><span class="string">  linux16 $BootDIR/vmlinuz inst.ks=file://ks.cfg $NOIPV6 quiet</span></span><br><span class="line"><span class="string">  initrd16 $BootDIR/initrd.img</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Make sure we only boot into our custom menu entry once</span></span><br><span class="line">sed -i <span class="string">&#x27;s/GRUB_DEFAULT=0/GRUB_DEFAULT=saved/g&#x27;</span> /etc/default/grub</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$CurrentRelese</span>&quot;</span> == <span class="string">&quot;Ubuntu&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	update-grub &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line">	grub-set-default <span class="string">&quot;Install <span class="variable">$Relese</span> <span class="variable">$DIST</span>&quot;</span> &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line">	grub-reboot <span class="string">&quot;Install <span class="variable">$Relese</span> <span class="variable">$DIST</span>&quot;</span> &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$CurrentRelese</span>&quot;</span> == <span class="string">&quot;Debian&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	grub-mkconfig -o <span class="variable">$GRUBDIR</span>/<span class="variable">$GRUBFILE</span> &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line">	grub-set-default <span class="string">&quot;Install <span class="variable">$Relese</span> <span class="variable">$DIST</span>&quot;</span> &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line">	grub-reboot <span class="string">&quot;Install <span class="variable">$Relese</span> <span class="variable">$DIST</span>&quot;</span> &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	grub2-mkconfig -o <span class="variable">$GRUBDIR</span>/<span class="variable">$GRUBFILE</span> &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line">	grub2-set-default <span class="string">&quot;Install <span class="variable">$Relese</span> <span class="variable">$DIST</span>&quot;</span> &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line">	grub2-reboot <span class="string">&quot;Install <span class="variable">$Relese</span> <span class="variable">$DIST</span>&quot;</span> &gt;&gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 1;</span><br></pre></td></tr></table></figure>
</details>


<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">参考文章:</span><br><span class="line">https:<span class="regexp">//</span>cnboy.org<span class="regexp">/archives/</span><span class="number">2317</span></span><br><span class="line">https:<span class="regexp">//</span>www.idcoffer.com<span class="regexp">/archives/</span><span class="number">7377</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/39/">39</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa-solid fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">meetabs</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
